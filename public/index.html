<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inlev</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Inleverans Äger</h1>
    <div class="nav"><button id="saveAll">Spara Sändning</button><button id="openAll">Öppna Sändning</button><input type="file" id="openFile" accept="application/json" style="display:none">
      <a href="/insamlare.html">Insamlare</a>
      <a href="/uppdatera-info.html">Uppdatera info</a>
      <a href="/felsok.html">Felsök</a>
    </div>
    <p class="small">v0.6.7 (Netlify): knappar fixade + uppdatera-info stabilt.</p>
  </div>

<script>
// Save/Load all inlev* localStorage keys to/from a JSON file
(function(){
  function blobDownload(name, data){
    const a=document.createElement('a');
    a.href=URL.createObjectURL(new Blob([data],{type:'application/json'}));
    a.download=name; document.body.appendChild(a); a.click(); setTimeout(()=>{URL.revokeObjectURL(a.href);a.remove();},1000);
  }
  window.saveAllData = function(){
    const dump = {};
    for(let i=0;i<localStorage.length;i++){
      const k=localStorage.key(i);
      if(/^inlev[:]/.test(k)) dump[k]=localStorage.getItem(k);
    }
    const name='inlev-sandning-'+new Date().toISOString().replace(/[:.]/g,'-')+'.json';
    blobDownload(name, JSON.stringify({version:'0.6.15', savedAt:new Date().toISOString(), data:dump}, null, 2));
  };
  window.loadAllData = function(file){
    const reader=new FileReader();
    reader.onload=()=>{
      try{
        const obj=JSON.parse(reader.result);
        const data=obj.data||obj; // accept raw dump
        let count=0;
        for(const k in data){ if(/^inlev[:]/.test(k)){ localStorage.setItem(k, data[k]); count++; } }
        alert('Laddat '+count+' nycklar. Ladda om sidan (Ctrl+R) om du inte ser uppdateringen direkt.');
      }catch(e){ alert('Fel vid läsning: '+e.message); }
    };
    reader.readAsText(file);
  };
  document.addEventListener('click', (ev)=>{
    const id=ev.target && ev.target.id;
    if(id==='saveAll') saveAllData();
    if(id==='openAll'){ document.getElementById('openFile').click(); }
  });
  document.addEventListener('change', (ev)=>{
    if(ev.target && ev.target.id==='openFile' && ev.target.files && ev.target.files[0]){
      loadAllData(ev.target.files[0]);
      ev.target.value='';
    }
  });
})();
</script>

</body>
</html>