
<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Schema – OCR</title>
  <link rel="stylesheet" href="./style.css">
  <!-- OpenCV.js för auto-beskärning & perspektivkorrigering -->
  <script async src="https://docs.opencv.org/4.x/opencv.js"
          onload="cv['onRuntimeInitialized']=()=>{window.__cvReady=true;}"></script>
  <!-- Tesseract.js för OCR -->
  <script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">Inlev • <strong>Schema</strong></div>
    <nav id="projectBar" class="project-bar">
      <a href="/plock/">Plock</a>
      <a href="/trav/">Trav</a>
      <a href="/statistik/">Statistik</a>
      <a class="active" href="/schema/">Schema</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="card upload">
      <h2>Ladda upp schema-bild</h2>

      <div class="uploader" id="dropZone">
        <input type="file" id="fileInput" accept="image/*" />
        <span>Dra & släpp bild här eller klicka för att välja…</span>
      </div>

      <div id="previewWrap" class="preview hidden">
        <div class="previewInner">
          <img id="preview" alt="Förhandsvisning">
          <canvas id="cropCanvas" class="cropCanvas hidden"></canvas>
        </div>
      </div>

      <div class="actions">
        <label><input type="checkbox" id="autoRectify" checked> Auto hitta & räta upp tabellen</label>
        <button id="cropModeBtn" disabled>Manuell beskärning</button>
        <button id="applyCropBtn" class="hidden">Använd beskärning</button>
        <button id="cancelCropBtn" class="hidden">Avbryt</button>
        <button id="startOcrBtn" disabled>Starta OCR</button>
        <button id="saveBtn" disabled>Spara denna OCR-post</button>
        <span id="status" class="status"></span>
      </div>

      <details class="raw">
        <summary>Visa rå OCR-text</summary>
        <pre id="rawText"></pre>
      </details>

      <h3>Resultat från denna bild</h3>
      <div id="parsed"></div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>Historik</h2>
        <div id="history"></div>
      </div>
      <div class="card">
        <h2>Statistik per person</h2>
        <div id="stats"></div>
      </div>
    </section>

    <section class="card">
      <h2>Inställningar</h2>
      <details id="config" open>
        <summary>Personer & alias</summary>
        <form id="addPersonForm" class="row">
          <input id="addPersonName" placeholder="Namn (kanoniskt)" required>
          <input id="addPersonAliases" placeholder="Alias (kommaseparerade) t.ex. Cecilia,Cissi">
          <button>Lägg till</button>
        </form>
        <div id="personList" class="personList"></div>
      </details>
    </section>
  </main>

  <footer class="foot">
    Tips: Om auto-funktionen missar tabellen – klicka <em>Manuell beskärning</em>, dra en ruta runt själva schemat och välj <em>Använd beskärning</em>.
  </footer>

  <script src="./app.js" type="module"></script>
</body>
</html>
