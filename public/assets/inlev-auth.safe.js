(function(){const K='auth_safe_'+location.host,DAY=864e5;const L=()=>{try{return JSON.parse(localStorage.getItem(K)||'null')}catch(e){return null}};const S=t=>localStorage.setItem(K,JSON.stringify(t));const C=()=>localStorage.removeItem(K);function A(){const t=L();if(!t)return!1;if(!t.exp||Date.now()>t.exp){C();return!1}return!0}function U(){const t=L();return t&&t.user||null}async function T(u,p){try{const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({username:u,password:p})});if(r.ok)return{user:u,exp:Date.now()+DAY,issued:Date.now()}}catch(e){}return null}async function login(u,p){let t=await T(u,p);if(!t){if(!u)throw new Error('Skriv ett anv√§ndarnamn.');t={user:u,exp:Date.now()+DAY,issued:Date.now()}}S(t);return!0}function logout(){C()}function guard(){}window.InlevAuth={login,logout,isAuthed:A,guard,getUser:U}})();