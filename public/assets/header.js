(async()=>{async function me(){try{const r=await fetch('/.netlify/functions/api/auth/me',{credentials:'include'});return r.ok?await r.json():null}catch{return null}}const u=await me();const h=document.getElementById('site-header')||(function(){const d=document.createElement('div');d.id='site-header';document.body.insertBefore(d,document.body.firstChild);return d;})();
h.innerHTML=`<div style="padding:12px 16px;background:#0d1420;border-bottom:1px solid #1f2a37;display:flex;gap:14px;align-items:center;color:#fff"><strong>Inlev</strong><a href="/plock/">Plock</a><a href="/trav/">Trav</a><a href="/statistik/">Statistik</a><a href="/schema/">Schema</a><a href="/sandningar/">Sandningar</a><a href="/users/">Users</a><span style="margin-left:auto;opacity:.9">Inloggad som: <strong>${u?.user||'Gäst'}</strong></span>${u?'<button id="logout" style="margin-left:10px;background:#ef4444;border:none;color:#fff;padding:8px 10px;border-radius:8px">Logga ut</button>':'<a href="/login.html" style="margin-left:10px;background:#4aa3ff;border:none;color:#fff;padding:8px 10px;border-radius:8px">Logga in</a>'}</div>`;
const btn=document.getElementById('logout'); if(btn) btn.onclick=async()=>{await fetch('/.netlify/functions/api/auth/logout',{method:'POST',credentials:'include'});location.replace('/login.html');};
const protectedDirs=['/plock','/trav','/statistik','/schema','/sandningar','/users']; const p=location.pathname; const needs=protectedDirs.some(d=>p===d||p.startsWith(d+'/')); if(needs&&!u){const main=document.querySelector('main')||document.body; main.innerHTML='<div class="wrap"><div class="card"><h2>Inloggning krävs</h2><p>Gå till <a href="/login.html">Login</a>.</p></div></div>';}})();