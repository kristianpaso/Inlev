(function(){const K='auth_enf_'+location.host,D=864e5,PK='postLogin';function g(){try{return JSON.parse(localStorage.getItem(K)||'null')}catch(e){return null}}function s(t){localStorage.setItem(K,JSON.stringify(t))}function c(){localStorage.removeItem(K)}function authed(){const t=g();if(!t)return!1;if(!t.exp||Date.now()>t.exp){c();return!1}return!0}async function login(u,p){let t;try{const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({username:u,password:p})});if(r.ok)t={user:u,exp:Date.now()+D}}catch(e){}if(!t){if(!u)throw new Error('Skriv ett anvÃ¤ndarnamn.');t={user:u,exp:Date.now()+D}}s(t);return!0}function remember(){try{sessionStorage.setItem(PK,location.pathname+location.search+location.hash)}catch(e){}}function consume(){try{const v=sessionStorage.getItem(PK);sessionStorage.removeItem(PK);return v||'/statistik/'}catch(e){return'/statistik/'}}function guard(){const prot=['/plock','/trav','/statistik','/schema'];const p=location.pathname;const needs=prot.some(d=>p===d||p.startsWith(d+'/'));if(needs&&!authed()){remember();if(!p.endsWith('/login.html')) location.replace('/login.html');}}function init(){try{guard();}catch(e){}if(authed()&&location.pathname.toLowerCase().endsWith('/login.html')){location.replace(consume());}}window.InlevAuth={login,logout:c,isAuthed:authed,guard};init();})();