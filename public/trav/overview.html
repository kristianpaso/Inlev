<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Trav ‚Äì √ñverblick</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./css/trav.css">
  <link rel="stylesheet" href="./css/horse-details.css">
</head>
<body>
  <div class="page">
    <header class="topbar overview-topbar">
      <button class="btn" id="btn-back">&#8592; Tillbaka</button>

      <div class="topbar-center">
        <h1 id="ov-title">√ñverblick</h1>
        <p class="subtitle" id="ov-meta"></p>
      </div>

      <div class="topbar-right">
        <span id="ov-game-type" class="badge"></span>
      </div>
    </header>

    <main class="overview-layout">
      <!-- Slider-header f√∂r avdelningar -->
 <section class="division-header">
 


  <!-- Pris-info (redan finns) -->
  <div id="price-info" class="price-info"></div>
  <button class="btn small stake-toggle" id="btn-toggle-stake" type="button" title="Insatsniv√•" aria-label="Insatsniv√•">üí∞</button>

  <!-- üîπ NYTT: insatsniv√• ‚Äì visas bara f√∂r V85 via JS -->
  <div id="stake-panel" class="stake-panel" hidden>
    <div class="stake-title">V√§lj insatsniv√• (V85)</div>
    <div class="stake-options">
      <button class="btn small stake-option" data-stake="original">
        Original<br><span class="stake-sub">0,50 kr (100%)</span>
      </button>
      <button class="btn small stake-option" data-stake="70">
        70%<br><span class="stake-sub">0,35 kr</span>
      </button>
      <button class="btn small stake-option" data-stake="50">
        50%<br><span class="stake-sub">0,25 kr</span>
      </button>
      <button class="btn small stake-option" data-stake="30">
        30%<br><span class="stake-sub">0,15 kr</span>
      </button>
    </div>
  </div>

    <div class="division-number-row" id="division-number-row"></div>
</section>


      <!-- Stora blocket med tre kolumner -->
      <section class="big-block">
        <div class="side-block" id="popular-block">
          <!--<h2>Popul√§rf√§lt</h2>-->
          <div id="popular-number-list" class="number-column">
            <!-- nummer fylls av JS -->
          </div>
        </div>

        <div class="center-block">
          <!--<h2>
            H√§star i avdelning
            <span id="center-division-index">1</span>
          </h2>-->

          <div id="horse-table-container" class="horse-table-wrapper">
            <!-- Tabell fylls av overview.js -->
          </div>
        </div>

        <div class="side-block" id="idea-block">
          <!--<h2>Id√©f√§lt</h2>-->
          <div id="idea-number-list" class="number-column"></div>
        </div>
      </section>
<!-- üîπ NYTT: filterblocket -->
<section class="filter-section">
  <div class="filter-block">
    <div class="filter-block-inner">
      <div class="list-mode-toggle">
    <button class="btn list-mode-btn" data-mode="simple">Enkel lista</button>
    <button class="btn list-mode-btn" data-mode="detailed">Detaljerad lista</button>
    <button class="btn list-mode-btn" data-mode="icons">Ikoner</button>
  </div>

  <!-- F√∂rklaring av alla ikoner (visas bara i ikon-l√§ge) -->
  <div class="icon-legend hidden" id="icon-legend"></div>
  </div>
</section>

<section class="coupon-section">
  <div class="coupon-section-header">
    <h2>Kuponger</h2>
    <button class="btn small coupon-menu-toggle" id="btn-coupon-menu-toggle" type="button">Meny</button>
  </div>

  <div class="coupon-layout">
    <div class="coupon-sidemenu-backdrop" id="coupon-sidemenu-backdrop" hidden></div>
    <aside class="coupon-sidemenu" id="coupon-sidemenu">
      <div class="coupon-sidemenu-header">
        <div class="coupon-sidemenu-title">Kupongmeny</div>
        <button class="btn small coupon-menu-close" id="btn-coupon-menu-close" type="button">‚úï</button>
      </div>
      <div class="coupon-sidemenu-actions">
        
             <!-- Grupp: Id√©f√§lts-kontroller -->
      <div class="coupon-idea-actions">
        <button class="btn small danger" id="btn-clear-idea">Rensa Id√©f√§lt</button>
        <button class="btn small" id="btn-save-idea-coupon">Spara Min kupong</button>
        <button class="btn small" id="btn-update-winners">Uppdatera vinnare</button>
        <button class="btn small" id="btn-fetch-stallsnack">H√§mta stallsnack</button>
        <button class="btn small" id="btn-info-coupon">Info kupong</button>
      </div>
         <!-- Egen knapp: vanliga kuponger -->
      <div class="coupon-new-actions">
        <button class="btn small" id="btn-add-coupon">Ny kupong</button>
      
        <button class="btn small" id="btn-open-chance">Chans kupong</button>
        <button class="btn small" id="btn-open-best-row">B√§sta raden</button>
        <button class="btn small" id="btn-open-jackpot">Jackpot kupong</button>
        <button class="btn small" id="btn-open-split">Split kupong</button>
        <button class="btn small" id="btn-open-reverse">Omv√§nd kupong</button>
        <button class="btn small" id="btn-open-import-atg">Importera ATG</button>
        <button class="btn small" id="btn-open-paste-coupon">Klistra kupong</button>
        <button class="btn small" id="btn-open-fill">Fyll p√• kupong</button>
        <button class="btn small" id="btn-open-notplayed" type="button">Inte spelad kupong</button>
      
        <button class="btn small" id="btn-combine-coupons">Kombinera kuponger</button>
<button class="btn small" id="btn-simulate-division" type="button">üé• Simulera</button>
        <button class="btn small" id="btn-simulate-all" type="button">üìä Simulera alla</button>

      </div>
    </aside>

    <div class="coupon-main">

<!-- Panel f√∂r att fyll p√• kupongen -->
  <div id="fill-panel" class="coupon-add-panel" hidden>
  <h3 style="margin-top:0">Fyll p√• kupong</h3>

  <div class="hint" id="fill-selected-info">V√§lj en kupong i listan‚Ä¶</div>

  <div class="form-row">
    <label for="fill-price">Pris (kr)</label>
    <input id="fill-price" type="number" min="1" step="1" value="200">
  </div>

  <div class="form-row">
    <label for="fill-count">Antal kuponger</label>
    <input id="fill-count" type="number" min="1" max="50" value="5">
  </div>

  <div class="form-row">
    <label for="fill-spikes">Antal spik</label>
    <input id="fill-spikes" type="range" min="0" max="8" value="2">
    <div class="slider-value"> <span id="fill-spikes-display">2</span> </div>
  </div>

  <div class="form-row">
    <label for="fill-profile">H√∂g procentare ‚Üí L√•g procentare</label>
    <input id="fill-profile" type="range" min="1" max="7" step="1" value="3">
    <div class="slider-value">
      Steg: <span id="fill-profile-display">3</span>
    </div>
    <div class="hint">
      Steg 1: 80/15/5 ‚Ä¢ Steg 2: 80/15/5 ‚Ä¢ Steg 3: 60/30/10 ‚Ä¢ Steg 4: 50/25/25 ‚Ä¢
      Steg 5: 30/30/40 ‚Ä¢ Steg 6: 15/20/65 ‚Ä¢ Steg 7: 5/15/80
    </div>
  </div>

  <div class="form-actions">
    <button class="btn primary" id="btn-fill-do">Skapa</button>
    <button class="btn" id="btn-fill-cancel" type="button">Avbryt</button>
  </div>
</div>

<!-- Panel f√∂r att klistra in kupongtext -->
<div id="paste-coupon-panel" class="coupon-add-panel" hidden>
  <h3>Klistra kupong</h3>

  <div class="form-row">
    <label for="paste-coupon-text">Kupongtext</label>
    <textarea id="paste-coupon-text" rows="12"
      placeholder="Klistra in kupongtext h√§r‚Ä¶"></textarea>
  </div>

  <div class="coupon-add-actions">
    <button class="btn primary" id="btn-paste-coupon-create">Skapa kupong</button>
    <button class="btn" id="btn-paste-coupon-cancel">Avbryt</button>
  </div>
</div>


  <!-- Panel f√∂r att Importera ATG-kupong -->

<!-- Importera ATG -->
<div id="import-atg-panel" class="panel" hidden>
  <div class="panel-title">Importera ATG</div>

  <label class="label" for="import-atg-preset">F√∂rinst√§llda l√§nkar</label>
  <select id="import-atg-preset" class="input">
    <option value="">‚Äî V√§lj ‚Äî</option>
  </select>

  <label class="label" for="import-atg-url">ATG-l√§nk</label>
  <input id="import-atg-url" class="input" type="text" placeholder="Klistra in ATG-l√§nk‚Ä¶" />

  <label class="label" for="import-atg-save-name">Spara l√§nk som</label>
  <input id="import-atg-save-name" class="input" type="text" placeholder="Ex. Speltorsken 25:-" />

  <div class="panel-actions">
    <button class="btn small" id="btn-import-atg-do">Importera kupong</button>
    <button class="btn small" id="btn-import-atg-cancel">Avbryt</button>
    <button class="btn small" id="btn-import-atg-save">Spara l√§nk</button>
  </div>
</div>




  <!-- Panel f√∂r att skapa kupong -->
  <div id="coupon-add-panel" class="coupon-add-panel" hidden>
    <h3>Ny kupong</h3>
    <p class="coupon-hint">
      Klicka p√• h√§stnumren i varje avdelning f√∂r att v√§lja vilka som ska med i kupongen.
    </p>

    <div id="coupon-builder" class="coupon-builder">
      <!-- Fylls av overview.js -->
    </div>

    <div class="coupon-add-actions">
      <button class="btn primary" id="btn-save-coupon">Spara kupong</button>
      <button class="btn" id="btn-cancel-coupon">Avbryt</button>
    </div>
  </div>

  <!-- Panel f√∂r att skapa kupong -->
  <div id="coupon-add-panel" class="coupon-add-panel" hidden>
    ...
  </div>

  <!-- üîπ NYTT: panel f√∂r Split kupong -->
  <div id="split-panel" class="coupon-add-panel" hidden>
    <h3>Split kupong</h3>

    <div class="form-row">
      <label for="split-name">Namn</label>
      <input id="split-name" type="text" placeholder="Ex. Skr√§llsystem" />
    </div>

    <div class="form-row">
      <label for="split-count">Hur m√•nga kuponger</label>
      <input id="split-count" type="number" min="1" value="2" />
    </div>

    <div class="form-row">
      <label for="split-max-price">Max pris per kupong (kr)</label>
      <input id="split-max-price" type="number" min="1" step="1" value="70" />
    </div>

    <div class="form-row">
      <label for="split-spikes">Antal spikar per kupong</label>
      <input id="split-spikes" type="number" min="0" value="2" />
    </div>

  

    <div class="form-row">
  <label for="split-pattern">F√∂rdelning (t.ex. 1x1x1x2x3x3x3x3)</label>
  <div id="split-pattern-suggestions" class="split-pattern-suggestions"></div>

  
  <input
    id="split-pattern"
    type="text"
    placeholder="l√§mna tomt f√∂r auto"
  />
</div>



<!-- Antal superskr√§llar (h√§star < 5% V85) per kupong -->
<div class="form-row">
  <label for="split-supers">Antal superskr√§llar per kupong</label>
  <input
    id="split-supers"
    type="number"
    min="0"
    step="1"
    value="0"
  />
</div>

<div class="form-row">
  <label class="form-label" for="split-use-popular">
    Bygg system fr√•n kuponger (popul√§rf√§lt)
  </label>
  <label class="toggle">
    <input type="checkbox" id="split-use-popular" checked>
    <span>P√• / Av</span>
  </label>
</div>

    <p class="hint">
      Systemet v√§ljer ut spikar fr√•n de mest spelade h√§starna i dina befintliga kuponger
      och bygger <em>N</em> nya kuponger runt dem.
    </p>

      <div class="coupon-add-actions">
      <div id="split-pattern-suggestions" class="split-pattern-suggestions"></div>
      <button class="btn primary" id="btn-split-do">Skapa split-kuponger</button>
      <button class="btn" id="btn-split-cancel">Avbryt</button>
    </div>
  </div>
<!-- Panel f√∂r Chance kupong -->
  <div id="chance-panel" class="coupon-add-panel" hidden>
  <h3>Chans kupong</h3>

  <div class="form-row">
    <label for="chance-name">Namn</label>
    <input id="chance-name" type="text" placeholder="Ex. Chans" />
  </div>

  
<div class="form-row">
    <label for="chance-count">Hur m√•nga chans-kuponger</label>
    <input id="chance-count" type="number" min="1" value="2" />
  </div>

  <div class="form-row">
    <label for="chance-max-price">Max pris per kupong (kr)</label>
    <input id="chance-max-price" type="number" min="1" step="1" value="100" />
  </div>

  <div class="form-row">
    <label for="chance-level">Chansniv√• (1‚Äì5)</label>
    <input id="chance-level" type="range" min="1" max="5" step="1" value="4" />
    <div class="slider-value" id="chance-level-display">4</div>
  </div>

  <div class="form-row">
  <label for="chance-spikes">Antal spik</label>
  <input
    id="chance-spikes"
    type="range"
    min="0"
    max="8"
    step="1"
    value="0"
  />
  <div class="slider-value" id="chance-spikes-display">0</div>
</div>

<div class="form-row">
  <label class="checkbox">
    <input type="checkbox" id="chance-include-secondfav" />
    Ta ibland med andrahandfavoriten (om n√§ra favoriten i %)
  </label>
</div>
  <div class="form-row">
    <label class="form-label" for="chance-prefer-unplayed">
      Prioritera h√§star som INTE spelats p√• i √∂vriga kuponger
    </label>
    <label class="toggle">
      <input type="checkbox" id="chance-prefer-unplayed" checked>
      <span>P√• / Av</span>
    </label>
  </div>

  <p class="hint">
    Favoriten √§r alltid med i varje avdelning. Chansniv√• styr hur aggressivt vi fyller p√• med
    skr√§llar/minst spelade h√§star (inom maxpriset).
  </p>

  <div class="coupon-add-actions">
    <button class="btn primary" id="btn-chance-do">Skapa chans-kuponger</button>
    <button class="btn" id="btn-chance-cancel">Avbryt</button>
  </div>
</div>


  <!-- Panel f√∂r B√§sta raden -->
<div id="best-row-panel" class="coupon-add-panel" hidden>
      <h3>B√§sta raden</h3>
      <p class="muted small" style="margin-top:-6px;">
        R√§knar ut 5 f√∂rslag som f√∂rs√∂ker ge <b>l√§gre pris</b>, <b>fler h√§star</b> och <b>f√§rre spikar</b> (baserat p√• V85%-rankingen i respektive avdelning).
      </p>

      <div class="form-row">
        <label for="best-row-max-price">Max pris (kr)</label>
        <input id="best-row-max-price" type="number" min="1" value="200" />
      </div>

      <div class="form-row">
        <label for="best-row-max-per-division">Max h√§star per avdelning</label>
        <input id="best-row-max-per-division" type="number" min="1" max="15" value="6" />
      </div>
      <div class="form-row">
        <label for="best-row-skrall-level">Skr√§llniv√•</label>
        <input id="best-row-skrall-level" type="range" min="0" max="100" step="5" value="60">
        <div class="muted small" id="best-row-skrall-level-display">60%</div>
      </div>

      <div class="form-row" style="gap:8px; display:flex; align-items:center;">
        <button class="btn" id="btn-generate-best-rows">R√§kna ut</button>
        <button class="btn secondary" id="btn-close-best-row">St√§ng</button>
      </div>

      <div id="best-row-results" class="coupon-suggestions" style="margin-top:10px;"></div>
    </div>
<!-- Panel f√∂r Jackpot kupong -->
<div id="jackpot-panel" class="coupon-add-panel" hidden>
  <div class="coupon-add-title">Jackpot kupong</div>
  <div class="coupon-add-grid">
    <label class="coupon-add-field">
      <span>Namn</span>
      <input id="jackpot-name" type="text" value="Jackpot" />
    </label>

    <label class="coupon-add-field">
      <span>Antal kuponger</span>
      <input id="jackpot-count" type="number" min="1" value="1" />
    </label>

    <label class="coupon-add-field">
      <span>Maxpris (kr)</span>
      <input id="jackpot-max-price" type="number" min="1" value="200" />
    </label>

    <label class="coupon-add-field">
      <span>Antal spik (0 = auto)</span>
      <input id="jackpot-spikes" type="number" min="0" max="8" value="0" />
    </label>

    <div class="coupon-add-hint">
      Jackpot-kupong f√∂rs√∂ker v√§lja mer ‚Äúunika‚Äù h√§star (l√•gt V%) och kompletterar med n√•gra extra streck tills maxpriset n√•s.
      Skapade kuponger hamnar i <b>V√§ntel√§ge</b>.
    </div>
  </div>

  <div class="coupon-add-actions">
    <button class="btn small" id="btn-jackpot-do">Skapa jackpot kupong</button>
    <button class="btn small secondary" id="btn-jackpot-cancel">Avbryt</button>
  </div>
</div>



  <!-- Panel f√∂r Omv√§nd kupong -->
  <div id="reverse-panel" class="coupon-add-panel reverse-panel" hidden>


    <div class="form-row">
      <label for="reverse-name">Rubrik</label>
      <input id="reverse-name" type="text" />
    </div>

<div class="form-row">
  <label for="reverse-price-slider">Pris (kr)</label>

  <!-- Slider med fasta l√§gen -->
  <input
    id="reverse-price-slider"
    type="range"
    min="0"
    max="8"
    step="1"
    value="0"
  />

  <!-- Text under slidern som visar valt l√§ge (1 kr, 25 kr, ... , Egen) -->
  <div class="slider-value" id="reverse-price-display">1 kr</div>

  <!-- Sj√§lva prisf√§ltet som JS anv√§nder.
       Det fylls automatiskt av slidern, och blir bara editerbart vid "Egen". -->
  <input
    id="reverse-price"
    type="number"
    min="1"
    step="1"
    style="margin-top: 4px; width: 100%;"
  />
</div>

<div class="form-row">
  <label for="reverse-spikes">Antal spik</label>
  <input
    id="reverse-spikes"
    type="range"
    min="0"
    max="8"
    step="1"
    value="0"
  />
  <div class="slider-value" id="reverse-spikes-display">0</div>
</div>

<div class="form-row">
  <label for="reverse-supers">Antal superskr√§llar</label>
  <input
    id="reverse-supers"
    type="range"
    min="0"
    max="40"
    step="1"
    value="0"
  />
  <div class="slider-value" id="reverse-supers-display">0</div>
</div>


    <div class="coupon-add-actions">
      <button class="btn primary" id="btn-create-reverse">Skapa Omv√§nd kupong</button>
      <button class="btn" id="btn-cancel-reverse">Avbryt</button>
    </div>
  </div>
    <div class="sim-embed-host" id="sim-embed-host">
      <div class="sim-embed-head">
        <h2>Simulering</h2>
        <button class="btn small" id="btn-sim-embed-toggle" type="button">D√∂lj simulering</button>
      </div>

      <div id="sim-overlay" class="sim-overlay sim-embed">
        <div class="sim-modal sim-tv-modal" role="region" aria-label="Simulering">
          <div class="sim-tv-topbar">
            <div class="sim-tv-topbar-left">
              <div id="sim-title" class="sim-tv-title">Simulering</div>
              <div id="sim-subtitle" class="sim-tv-subtitle"></div>
            </div>

            <div id="sim-div-tabs" class="sim-div-tabs" role="tablist" aria-label="Avdelningar"></div>

            <div class="sim-tv-topbar-right">
              <button class="btn small" id="btn-sim-settings-toggle" type="button" aria-label="Inst√§llningar">Inst√§llningar</button>
            </div>
          </div>

          <div class="sim-tv-body">
            <div id="sim-one-wrap" class="sim-tv-one">
              <div class="sim-tv-stage">
                <div class="sim-minimap-row">
                  <div class="sim-minimap" id="sim-minimap">
                    <div class="sim-minimap-label">Karta</div>
                    <canvas id="sim-mini-canvas"></canvas>
                  </div>
                </div>

                <div class="sim-tv-canvas-wrap">
                  <canvas id="sim-canvas"></canvas>

                  <div id="sim-winner" class="sim-winner" hidden>
                    <div class="sim-winner-banner" id="sim-winner-banner">VINNARE H√ÑST</div>
                    <div class="sim-winner-card">
                      <div class="sim-winner-num" id="sim-winner-num">#</div>
                      <div class="sim-winner-name" id="sim-winner-name">-</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="sim-all-wrap" class="sim-tv-all" hidden>
              <div class="sim-all-header">
                <div class="sim-all-title">Alla avdelningar</div>
                <div class="sim-all-hint">Tryck ‚Äú‚ñ∂ K√∂r‚Äù f√∂r att simulera.</div>
              </div>
              <div id="sim-all-results" class="sim-all-results"></div>
            </div>

            <div id="sim-settings" class="sim-settings-drawer" hidden>
              <div class="sim-settings-inner">
                <div class="sim-settings-title">Inst√§llningar</div>

                <div class="sim-inputs-grid">
                  <label class="sim-field"><span>Seed</span><input id="sim-seed" type="number" placeholder="Auto"></label>
                  <label class="sim-field"><span>Iterationer</span><input id="sim-iters" type="number" value="300" min="10" step="10"></label>
                  <label class="sim-field"><span>Vind (m/s)</span><input id="sim-wind" type="number" value="2" step="0.1"></label>
                  <label class="sim-field"><span>Temp (¬∞C)</span><input id="sim-temp" type="number" value="12" step="0.1"></label>
                  <label class="sim-field"><span>Sn√∂ (cm)</span><input id="sim-snow" type="number" value="0" step="0.1"></label>
                  <label class="sim-field"><span>M√•lpris (kr)</span><input id="sim-target-price" type="number" value="350" step="1"></label>
                </div>

                <div class="sim-history-wrap">
                  <div class="sim-history-title">Vinnarlogg</div>
                  <div id="sim-history" class="sim-history"></div>
                  <div id="sim-history-meta" class="sim-history-meta"></div>
                  <button class="btn small" id="btn-sim-clear-history" type="button">Rensa logg</button>
                </div>
              </div>
            </div>
          </div>

          <div class="sim-tv-bottom">
            <div class="sim-bottom-left">
              <div class="sim-bottom-caption">Topp 3</div>
              <div id="sim-top3" class="sim-top3"></div>
            </div>

            <div class="sim-bottom-center">
              <div class="sim-bottom-caption">Plats 5 -> 1</div>
              <div id="sim-pos-5to1" class="sim-pos-5to1"></div>

              <div class="sim-controls" style="margin-top:8px;">
                <button class="btn small" id="btn-sim-run" type="button">K√∂r</button>
                <button class="btn small" id="btn-sim-replay" type="button" disabled>Replay</button>
                <button class="btn small" id="btn-sim-coupon" type="button">Sim Kupong</button>
              </div>
              <div id="sim-log" class="sim-log"></div>
            </div>

            <div class="sim-bottom-right">
              <div class="sim-stake-row">
                <div class="sim-stake-label">Insats:</div>
                <div id="sim-stake" class="sim-stake-value">-</div>
              </div>
              <div class="sim-win-row">
                <div class="sim-win-label">Vinst:</div>
                <div id="sim-win" class="sim-win-value">-</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>





  <!-- Lista med sparade kuponger -->
  <div id="coupon-list" class="coupon-list">
    <!-- Kupong-kort skapas i overview.js -->
  </div>

    </div> <!-- /coupon-main -->
  </div> <!-- /coupon-layout -->
</section>
<!-- Baninformation -->
<section id="track-info-section" class="track-info-section">
  <h2>Bana</h2>
  <div id="track-info-box" class="track-info-box">
    <!-- Banf√∂rklaring -->
  </div>

  <div id="track-weather-box" class="track-weather-box">
    <!-- V√§der-info fylls av overview.js -->
  </div>
</section>

    </main>
  </div>

  <!-- Loaded as classic script (not module) to avoid "Unexpected token 'export'" in some environments -->
  <script src="./js/race-sim.js?v=20260120-fix1"></script>
  <script type="module" src="./js/overview.js"></script>
  <script type="module" src="./js/ui-coupon-combine.js?v=20260109-combine1"></script>

</body>
</html>
