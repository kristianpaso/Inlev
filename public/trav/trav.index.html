<!doctype html>
<html lang="sv">
<head>
<style>
.topbar{position:sticky;top:0;z-index:90;display:flex;gap:.5rem;align-items:center;background:#0a0f1a;border-bottom:1px solid #1f2937;padding:.5rem 1rem}
.btn{padding:.5rem .8rem;border-radius:.5rem;background:#1f2937;color:#f3f4f6;border:1px solid #334155;text-decoration:none;cursor:pointer}
.muted{opacity:.75;margin-right:.5rem}
.small{font-size:.9em}
.spacer{flex:1}
</style>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inlev • Trav (Förhandsvisning + Kalibrering v2)</title>
  <script src="/trav/app.js" defer></script>
  <style>
    :root { --bg:#0b0c10; --panel:#111319; --muted:#9aa3b2; --text:#e6e8ec; --accent:#6aa3ff; --border:#1c2030; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:1240px;margin:0 auto;padding:20px}
    .card{background:#111319;border:1px solid var(--border);border-radius:16px;padding:14px 16px;margin:12px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .table{border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .trow{display:grid;grid-template-columns:.6fr 1.8fr 1.2fr;padding:8px 12px;border-top:1px solid var(--border);align-items:center}
    .thead{background:#0e1522;color:#c7cfdd;border-top:0}
    .mini{color:#9aa3b2;font-size:12px}
    .head{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{background:var(--accent);color:#081024;border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
    input[type="file"]{background:#0f1420;color:#e6e8ec;border:1px solid var(--border);padding:8px;border-radius:12px}
    canvas{max-width:100%;background:#0a0f18;border:1px solid var(--border);border-radius:8px}
    .pill{display:inline-block;padding:3px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .kbd{font-family:monospace;background:#0f1420;padding:2px 6px;border-radius:6px;border:1px solid var(--border)}
  </style>
</head>
<body>
<nav id="projectBar" class="topbar">
  <span class="muted">Projekt:</span>
  <a href="../sandningar/index.html" class="btn">Sändningar</a>
  <a href="../trav/index.html" class="btn">Trav</a>
  <a href="../plock/index.html" class="btn">Plock</a>
  <a href="../schema/index.html" class="btn">Schema</a>
  <a href="../statistik/index.html" class="btn">Statistik</a>
  <a href="../users/index.html" class="btn">Users</a>
  <span class="spacer"></span>
  <span id="whoami" class="muted small"></span>
  <button id="btnLogout" class="btn">Logga ut</button>
</nav>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const u = localStorage.getItem('inlev_user') || 'inloggad';
  const w = document.getElementById('whoami'); if(w) w.textContent = 'Inloggad som: ' + u;
  const b = document.getElementById('btnLogout'); if(b) b.onclick = () => { localStorage.clear(); location.href='../login.html'; };
});
</script>

  <main class="wrap">
    <div class="card">
      <div class="head">
        <h2 style="margin:0">Trav – Förhandsvisning & Kalibrering v2 (viewport-korrigerad)</h2>
        <input id="pdfFile" type="file" accept="application/pdf">
        <button id="parsePdf" type="button" class="btn">Bygg förhandsvisning</button>
        <span id="status" class="mini"></span>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:6px">
        <button id="tabPreview" class="btn" style="background:#162034">Förhandsvisning</button>
        <button id="tabCalib" class="btn">Kalibrera layout</button>
        <span class="mini">Kalibrering sparas i localStorage och gäller denna PDF-layout. V2 använder **samma koordinater** för canvas & parser.</span>
      </div>
      <div id="previewPane"></div>
      <div id="calibPane" style="display:none;margin-top:10px">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
          <div>
            <button id="loadPg" class="btn">Visa 1 sida</button>
            <span class="mini">Klicka linjer: <span class="pill">NrX</span> → <span class="pill">Namn X1</span> → <span class="pill">Namn X2</span> → <span class="pill">Kusk X1</span> → <span class="pill">Kusk X2</span></span>
            <div style="margin-top:8px"><canvas id="calibCanvas" width="650" height="920"></canvas></div>
          </div>
          <div>
            <h3 style="margin:0 0 6px">Inställningar</h3>
            <div class="mini">Justera vid behov. <em>nameYOffset</em> styr att namnraden oftast ligger <strong>lite ovanför</strong> nummerraden.</div>
            <div style="display:flex;gap:10px;margin-top:6px;flex-wrap:wrap">
              <label>NrX: <input id="f_numX" type="number" class="kbd" style="width:90px"></label>
              <label>Namn x1: <input id="f_nameX1" type="number" class="kbd" style="width:90px"></label>
              <label>Namn x2: <input id="f_nameX2" type="number" class="kbd" style="width:90px"></label>
              <label>Kusk x1: <input id="f_drvX1" type="number" class="kbd" style="width:90px"></label>
              <label>Kusk x2: <input id="f_drvX2" type="number" class="kbd" style="width:90px"></label>
            </div>
            <div style="display:flex;gap:10px;margin-top:6px;flex-wrap:wrap">
              <label>yTol: <input id="f_yTol" type="number" step="0.1" class="kbd" style="width:80px"></label>
              <label>nameYOffset: <input id="f_nameDY" type="number" step="0.5" class="kbd" style="width:100px"></label>
            </div>
            <div style="display:flex;gap:10px;margin-top:8px">
              <button id="saveCalib" class="btn">Spara</button>
              <button id="resetCalib" class="btn">Återställ</button>
            </div>
            <pre id="calibJson" class="mini" style="white-space:pre-wrap;background:#0f1420;border:1px solid var(--border);padding:8px;border-radius:8px;margin-top:8px"></pre>
          </div>
        </div>
      </div>
    </div>
    <div id="host" class="grid"></div>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('nav').forEach(n => {
    if (n.id === 'projectBar') return;
    const t = (n.textContent || '').toLowerCase();
    if (t.includes('inlev') && /(plock|trav|statistik|schema|sandning|users)/.test(t)) n.remove();
  });
  // Force .html targets
  const map = {'Sändningar':'sandningar/sandningar.html','Sandningar':'sandningar/sandningar.html','Trav':'trav.html','Plock':'plock.html','Schema':'schema.html','Statistik':'statistik.html','Users':'users.html'};
  document.querySelectorAll('#projectBar a').forEach(a=>{
    const txt=(a.textContent||'').trim(); if(map[txt]) a.href = (a.href.includes('../')?'../':'') + map[txt];
  });
});
</script>

</body>
</html>
